<!DOCTYPE html>
<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <link crossorigin="anonymous" media="all" rel="stylesheet" href="web.css"/>
    <link rel="stylesheet" href="https://openlayers.org/en/v6.5.0/css/ol.css" type="text/css">
    <script src="https://openlayers.org/en/v6.5.0/build/ol.js"></script>

    <title>Emergency Events</title>
</head>
<body>
<header>
    <h1>Emergency Events</h1>
</header>

<div class="grid-container">

    <div class="grid-item">
        <h2>UK COVID-19 Statistics</h2>
        <canvas id="covidCasesChart"></canvas>
        <br>
        <br>
        <p>At the beginning of 2022, many parts of the world experienced a surge in COVID-19 cases. January and February
            were particularly challenging months, as the highly infectious Omicron variant of the virus spread rapidly,
            leading to a sharp increase in the number of new infections. Hospitals became overwhelmed with patients, and
            governments had to implement strict measures to slow the spread of the virus. However, as more people became
            vaccinated and booster shots were rolled out, the number of cases gradually began to decrease. By late
            February, many countries saw a significant drop in daily case numbers, giving some hope that the worst of
            the pandemic may be over. Nonetheless, the situation remains unpredictable, and people are still being
            encouraged to take all necessary precautions to protect themselves and others.</p>
    </div>

    <div class="grid-item">
        <h2>Warnings</h2>
        <canvas id="warningChart"></canvas>
        <br>
        <br>
        <p>
            Terrorism and transportation disruption are often interlinked, as terrorist attacks can cause significant
            disruption to transportation systems such as airports, train stations, and public transportation.
            The disruption can range from temporary delays to long-term closures, which can have serious economic,
            social, and security consequences. Some common methods of transportation disruption used by
            terrorists include bombings, hijackings, cyber-attacks, and sabotage. Governments and transportation
            authorities around the world have implemented various security measures to prevent terrorist attacks and
            minimize the impact of transportation disruption. These measures include increased surveillance, passenger
            screening, and emergency response planning. Despite these efforts, the threat of terrorism and
            transportation disruption remains a significant challenge for societies worldwide.
        </p>
    </div>

    <div class="grid-item">
        <h2>Crime Statistics in Cardiff</h2>
        <canvas id="crimeChart"></canvas>
        <br>
        <br>
        <p>
            In the UK, crime rates have shown a trend of increasing in April, followed by a tapering off in the
            following months. This may be due to factors such as increased free time among young people at the end of
            the academic year, and an uptick in travel-related crime during the Easter holiday. However, as the year
            progresses, crime rates tend to decrease due to factors such as increased police presence during the summer
            months and greater community involvement in crime prevention efforts. It is important for the government
            and law enforcement agencies to be aware of these seasonal fluctuations and implement appropriate measures
            to address them.
        </p>
    </div>

    <div class="grid-item">
        <h2>Global Natural Disasters</h2>
        <div id="map" style="width:100%; height:500px;"></div>
    </div>

    <div class="grid-item">
        <h2>Breaking News</h2>
        <ul id="articles-section">
            <!--Dynamically generated by server / jquery            -->
        </ul>
    </div>

    <div class="grid-item">
        <h2>Resources</h2>
        <ul class="navigation">
            <li><a id="terror-link" href="terror-resources.html" data-resource-type="terror">Terrorism</a></li>
            <li><a id="environment-link" href="environment-resources.html" data-resource-type="environment">Environmental</a></li>
            <li><a id="public-health-link" href="health-resources.html" data-resource-type="public_health">Public Health</a></li>
            <li><a id="civil-emergency-link" href="civil-resources.html" data-resource-type="civil_emergency">Civil Emergency</a></li>
            <li><a id="transportation-link" href="transport-resources.html" data-resource-type="transportation">Transportation Disruptions</a></li>
            <li><a id="natural-disasters-link" href="natural-disaster-resources.html" data-resource-type="natural_disasters">Natural Disasters</a></li>
        </ul>
    </div>


</div>

<script>
    $(document).ready(function () {
        // // Add click event listener to all anchor tags in the navigation list
        // $('.navigation a').click(function(event) {
        //     // Prevent the default behavior of the anchor tag
        //     event.preventDefault();
        //     // Get the value of the "data-resource-type" attribute
        //     const resourceType = $(this).attr('data-resource-type');
        //     // Append the resource type to the URL of the target page
        //     const url = $(this).attr('href') + `?type=${resourceType}`;
        //     // Navigate to the target page with the appended URL parameter
        //     window.location.href = url;
        // });

        var indonesia = ol.proj.fromLonLat([120.9842, -2.9639]);
        var sriLanka = ol.proj.fromLonLat([80.7718, 7.8731]);
        var china = ol.proj.fromLonLat([104.1954, 35.8617]);
        var pakistan = ol.proj.fromLonLat([69.3451, 30.3753]);
        var japan = ol.proj.fromLonLat([138.2529, 36.2048]);
        var turkey = ol.proj.fromLonLat([38.9637, 35.2433]);

        var data = [
            { geometry: new ol.geom.Point(indonesia), weight: 10 },
            { geometry: new ol.geom.Point(sriLanka), weight: 2 },
            { geometry: new ol.geom.Point(turkey), weight: 5 },
            { geometry: new ol.geom.Point(china), weight: 2 },
            { geometry: new ol.geom.Point(pakistan), weight: 3},
            { geometry: new ol.geom.Point(japan), weight: 1 }
        ];

        var features = data.map(function(item) {
            var feature = new ol.Feature({
                geometry: item.geometry
            });
            feature.set('weight', item.weight);
            return feature;
        });

        var source = new ol.source.Vector({
            features: features
        });

        var heatmap = new ol.layer.Heatmap({
            source: source,
            blur: 20,
            radius: 15,
            gradient: ['#00f', '#0ff', '#0f0', '#ff0', '#f00']
        });

        var map = new ol.Map({
            target: 'map',
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.OSM()
                }),
                heatmap
            ],
            view: new ol.View({
                center: japan,
                zoom: 5
            })
        });



        $.get("http://localhost:8080/articles", function (data) {
            for (let i = 0; i < data.length; i++) {
                var article = data[i];
                var headline = article.headline;
                var imagePath = article.imagePath;
                var body = article.body;
                var date = article.dateTime;

                $('#articles-section').append(`
                    <li>
                        <h1>${headline}</h1>
                        <img src="${imagePath}">
                        <p>${body}</p>
                        <time>${date}</time>
                    </li>
                `);
            }
        });

        $.get("http://localhost:8080/crime/graph", function (data) {
            var ctx = document.getElementById('crimeChart').getContext('2d');
            var crimeChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Cases of crime (100s)',
                        data: data.data,
                        backgroundColor: 'rgba(0, 188, 212, 0.2)',
                        borderColor: 'rgba(0, 188, 212, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        });

        $.get("http://localhost:8080/covid/graph", function (data) {
            var ctx = document.getElementById('covidCasesChart').getContext('2d');
            var covidCasesChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Number of Cases 2022',
                        data: data.data,
                        backgroundColor: 'rgba(0, 188, 212, 0.2)',
                        borderColor: 'rgba(0, 188, 212, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        });

        $.get("http://localhost:8080/warning/graph", function (data) {
            var ctx = document.getElementById('warningChart').getContext('2d');
            var warningsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels,
                    datasets: [{
                        label: 'Emergency Severity Status',
                        data: data.data,
                        backgroundColor: function(context) {
                            var index = context.dataIndex;
                            var value = context.dataset.data[index];
                            var colors = ['#11ff00', '#00ffee', '#ffff00', '#ff6a00', '#ff0000'];
                            return colors[value - 1];
                        },
                        borderColor: 'rgba(0, 188, 212, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });
        });
    });

</script>
</body>
</html>